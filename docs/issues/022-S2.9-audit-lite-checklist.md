---
id: S2.9
title: "Audit-lite checklist"
epic: "E5 - Security & QA"
sprint: "Sprint 2"
estimate: 3
labels: ["security", "audit", "sprint-2"]
assignees: ["be1", "be2"]
dependencies: ["S2.1", "S2.2", "S2.3", "S2.8"]
status: "done"
---

## Context
Rà soát cuối trước mainnet: permissions, errors, deadcode, events, gas.

## Scope
- Checklist audit-lite
- Khuyến nghị sửa lỗi (nếu có)

## Acceptance Criteria
- Checklist hoàn tất, không có blocker

## Tasks
- Soát permissions & access controls
- Event coverage
- Gas review

## Checklist (audit-lite)

- Permissions & access controls
	- Owner-only: `setParamsForNext`, `pause`, `unpause` (Ownable). PASS
	- Non-admin user paths guarded: commit/reveal gated by phase windows and `whenNotPaused`. PASS
	- Treasury immutable, cannot be changed post-deploy. PASS
	- Reentrancy: `settleRound`, `claimTreat` are `nonReentrant`; CEI respected. PASS

- Errors & input validation
	- Dedicated errors for key states: `CommitClosed`, `RevealClosed`, `AlreadyCommitted`, `AlreadyRevealed`, `AlreadyClaimed`, `AlreadySettled`, `BadStake`, `BadReveal`, `NoCommit`, `NotSettled`, `NotWinner`. PASS
	- Admin setter validates stake>0, durations>0, fee cap <= 20%, forfeit params bounded, and normalizes bps for None/Full. PASS

- Events
	- Core emitted: `RoundCreated`, `MeowCommitted`, `MeowRevealed`, `RoundMeowed`, `TreatClaimed`. PASS
	- Admin/config: `NextParamsUpdated`; pause/unpause covered by OZ events. PASS
	- Event minimality checked in tests for settle. PASS

- Asset handling (Native & ERC-20)
	- Native: value == stake required on commit; payouts/fees via .call with success checks. PASS
	- ERC-20: SafeERC20 used for transferFrom/transfer; fees/penalties/payouts use same asset. PASS
	- No loops over participants on settle/claim. PASS

- Gas & scalability
	- No unbounded loops in state-changing external functions; claim is O(1), settle O(1)-like. PASS
	- Gas sanity tests: settle scales within bound; minimal event emissions verified. PASS

- Fuzz/invariants
	- Property-based invariants ensure total winners’ claims per settled round <= distributable in both native and ERC‑20 modes. PASS

## Findings & recommendations

- Blockers: None.
- Improvements (non-blocking):
	- Consider Ownable2Step for safer ownership transfers in production.
	- Consider enabling via-IR in CI for compiler robustness on complex tests.
	- Optional: emit a specific event on `pause`/`unpause` beyond OZ if offchain indexing prefers namespaced events (current OZ events are sufficient).

## Verification

- All tests green locally: 30/30 (unit, property/fuzz, invariants).
- S2.1/S2.2/S2.3/S2.8 dependencies validated by passing suites and docs.
