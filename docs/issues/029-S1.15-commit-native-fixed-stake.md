---
id: S1.15
title: "Commit (native, stake cố định) + 1 vé/địa chỉ/vòng"
epic: "E1 - Smart Contract Core"
sprint: "Sprint 1"
estimate: 3
labels: ["contract", "commit", "sprint-1"]
assignees: ["be1"]
dependencies: ["S1.14", "S1.2"]
status: "open"
---

## Context
Người chơi gửi hash (tribe,salt) và stake cố định để tham gia; đảm bảo 1 vé/địa chỉ/vòng.

## Scope
- Guard pha `CommitOpen`
- Yêu cầu `msg.value == stake` (native mode)
- Chặn double-commit cùng round
- Ghi commitment và emit `MeowCommitted(id, player)`

## Acceptance Criteria
- Commit hợp lệ được ghi và phát event
- Sai stake, sai pha, hoặc double-commit bị revert

## Tasks
- [ ] Hàm `makeCommitment(tribe,salt)` (pure) thống nhất với FE
- [ ] Hàm `commitMeow(commitment)` (native)
- [ ] Ràng buộc 1 vé/địa chỉ/vòng
- [ ] Unit tests: stake đúng/sai, deadline, double-commit

## Test Cases
- Commit với stake chuẩn và sai
- Double-commit cùng address
- Sai pha (ngoài CommitOpen)

## Tham chiếu thiết kế
- § 4 (Commit), § 7.3 (API), § 7.6 (Payout & fee), § 17.1/17.2 (commitment)

