---
id: S1.16
title: "Reveal (xác minh hash, cập nhật count/pool)"
epic: "E1 - Smart Contract Core"
sprint: "Sprint 1"
estimate: 3
labels: ["contract", "reveal", "sprint-1"]
assignees: ["be1"]
dependencies: ["S1.15"]
status: "done"
---

## Context
Reveal xác minh hash(tribe,salt) khớp commitment; cập nhật số lượng và pool mỗi phe; chặn double-reveal.

## Scope
- Guard pha `RevealOpen`
- Kiểm tra hash khớp commitment lưu trước đó
- Cập nhật `countMilk/countCacao` và `poolMilk/poolCacao`
- Đánh dấu đã reveal; emit `MeowRevealed`

## Acceptance Criteria
- Reveal hợp lệ cập nhật state đúng
- Sai hash/pha hoặc double-reveal bị revert

## Tasks
- [ ] Implement kiểm tra hash
- [ ] Cập nhật counters và pools theo stake
- [ ] Unit tests: hash sai/đúng, chưa commit mà reveal, double-reveal

## Test Cases
- Salt sai/đúng; tribe sai/đúng
- Người chưa commit gọi reveal → revert

## Tham chiếu thiết kế
- § 4 (Reveal), § 7.3 (API)

