---
id: S1.20
title: "Tie (MVP=refund) + cấu hình tieMode (stub)"
epic: "E1 - Smart Contract Core"
sprint: "Sprint 1"
estimate: 3
labels: ["contract", "tie", "sprint-1"]
assignees: ["be1"]
dependencies: ["S1.17", "S1.18"]
status: "open"
---

## Context
Trong MVP, tie xử lý theo refund cho người reveal hợp lệ; chuẩn bị stub tham số `tieMode` để mở rộng (rollover) ở v2 nhưng khoá ở refund trong v1.

## Scope
- Flag tie từ `settle`
- Refund stake cho revealer trong `claim`
- Stub `tieMode` (không bật rollover ở v1)

## Acceptance Criteria
- Tie refund hoạt động ổn định và bảo toàn tổng tiền
- Không bật rollover trong v1

## Tasks
- [ ] Xác định đường dẫn claim khi tie
- [ ] Hoàn stake cho revealer; non-revealer theo forfeit v1 (none)
- [ ] Unit tests: nhiều revealer, không reveal

## Test Cases
- Tie với nhiều người; tổng claim đúng
- Không ai reveal → refund=0

## Tham chiếu thiết kế
- § 4 (Hòa), § 7.7 (Hòa & Rollover)

